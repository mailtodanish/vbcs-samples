{
  "description": "",
  "variables": {
    "files": {
      "required": true,
      "type": "object[]",
      "input": "fromCaller"
    }
  },
  "root": "ifValidFileName",
  "actions": {

    "updateOCMServerStatusBusy": {
      "module": "vb/action/builtin/assignVariablesAction",
      "parameters": {
        "$page.variables.ocmServerBusy": {
          "source": "{{ true }}"
        }
      },
      "outcomes": {
        "success": "callUploadFileRestEndpoint"
      }
    },
    "callUploadFileRestEndpoint": {
      "module": "vb/action/builtin/restAction",
      "parameters": {
        "endpoint": "ocm/uploadFile",
        "body": {
          "jsonInputParameters": "{{ '{ \"parentID\":\"self\"}' }}",
          "primaryFile": "{{ $variables.files[0] }}"
        },
        "contentType": "multipart/form-data",
        "uriParams": {
          "filename": "{{ $variables.files[0].name }}"
        }
      },
      "outcomes": {
        "success": "fireSuccessNotification",
        "failure": "fireErrorNotification2"
      }
    },
    "updateOCMServerStatusReady": {
      "module": "vb/action/builtin/assignVariablesAction",
      "parameters": {
        "$page.variables.ocmServerBusy": {
          "source": "{{ false }}"
        }
      }
    },
    "fireErrorNotification2": {
      "module": "vb/action/builtin/fireNotificationEventAction",
      "parameters": {
        "displayMode": "persist",
        "type": "error",
        "summary": "Upload failed"
      }
    },
    "fireErrorNotification3": {
      "module": "vb/action/builtin/fireNotificationEventAction",
      "parameters": {
        "summary": "File is too big. (1MB is limit)"
      }
    },
    "fireErrorNotification4": {
      "module": "vb/action/builtin/fireNotificationEventAction",
      "parameters": {
        "summary": "Only jpeg, gif and png formats are supported."
      }
    },
    "fireSuccessNotification": {
      "module": "vb/action/builtin/fireNotificationEventAction",
      "parameters": {
        "displayMode": "transient",
        "type": "info",
        "summary": "{{ 'File ' + $variables.files[0].name + ' was successfully uploaded' }}"
      },
      "outcomes": {
        "success": "refreshDataProvider"
      }
    },
    "refreshDataProvider": {
      "module": "vb/action/builtin/fireDataProviderEventAction",
      "parameters": {
        "target": "[[ $page.variables.ocmFilesSDP ]]",
        "refresh": null
      },
      "outcomes": {
        "success": "updateOCMServerStatusReady"
      }
    },
    "ifValidFileSize": {
      "module": "vb/action/builtin/ifAction",
      "parameters": {
        "condition": "[[ $variables.files[0].size < 1100000 ]]"
      },
      "outcomes": {
        "true": "updateOCMServerStatusBusy",
        "false": "fireErrorNotification3"
      }
    },
    "ifValidFileName": {
      "module": "vb/action/builtin/ifAction",
      "parameters": {
        "condition": "[[ $variables.files[0].name !== undefined ]]"
      },
      "outcomes": {
        "true": "ifValidFileSize",
        "false": "fireErrorNotification4"
      }
    }
  }
}